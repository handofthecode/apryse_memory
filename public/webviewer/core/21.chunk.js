/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{572:function(xa,ta,f){f.r(ta);var qa=f(0),na=f(7),oa=f(3);xa=f(55);var ja=f(33),la=f(14);f=function(){function ha(){this.init()}ha.prototype.init=function(){this.zja=!1;this.fg=this.Qn=this.connection=null;this.Bv={};this.ga=this.nL=null};ha.prototype.bFa=function(ca){for(var ba=this,r=0;r<ca.length;++r){var h=ca[r];switch(h.at){case "create":this.Bv[h.author]||(this.Bv[h.author]=h.aName);this.ota(h);break;case "modify":this.ga.er(h.xfdf).then(function(b){ba.ga.wb(b[0])});
break;case "delete":this.ga.er("<delete><id>"+h.aId+"</id></delete>")}}};ha.prototype.ota=function(ca){var ba=this;this.ga.er(ca.xfdf).then(function(r){r=r[0];r.authorId=ca.author;ba.ga.wb(r);ba.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[r])})};ha.prototype.Jsa=function(ca,ba,r){this.Qn&&this.Qn(ca,ba,r)};ha.prototype.preloadAnnotations=function(ca){this.addEventListener("webViewerServerAnnotationsEnabled",this.Jsa.bind(this,ca,"add",{imported:!1}),{once:!0})};ha.prototype.initiateCollaboration=
function(ca,ba,r){var h=this;if(ca){h.fg=ba;h.ga=r.ma();r.addEventListener(na.h.DOCUMENT_UNLOADED,function(){h.disableCollaboration()});h.JFa(ca);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var a=JSON.parse(b.responseText);h.connection=exports.da.xGa(Object(ja.k)(h.fg,"blackbox/"),"annot");h.nL=a.id;h.Bv[a.id]=a.user_name;h.ga.lU(a.id);h.connection.PJa(function(n){n.t&&n.t.startsWith("a_")&&n.data&&h.bFa(n.data)},function(){h.connection.send({t:"a_retrieve",
dId:ca});h.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[h.Bv[a.id],h.nL])},function(){h.disableCollaboration()})}catch(n){Object(oa.g)(n.message)}});b.open("GET",Object(ja.k)(this.fg,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();h.zja=!0;h.ga.z9(function(a){return h.Bv[a.Author]||a.Author})}else Object(oa.g)("Document ID required for collaboration")};ha.prototype.disableCollaboration=function(){this.Qn&&(this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Qn),this.Qn=
null);this.connection&&this.connection.Zs();this.ga&&this.ga.lU("Guest");this.init();this.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ha.prototype.JFa=function(ca){var ba=this;this.Qn&&this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Qn);this.Qn=function(r,h,b){return Object(qa.b)(this,void 0,void 0,function(){var a,n,e,w,aa,y,z,x,fa;return Object(qa.d)(this,function(ea){switch(ea.label){case 0:if(b.imported)return[2];a={t:"a_"+h,dId:ca,annots:[]};return[4,ba.ga.h1()];
case 1:n=ea.ba();"delete"!==h&&(e=(new DOMParser).parseFromString(n,"text/xml"),w=new XMLSerializer);for(aa=0;aa<r.length;aa++)y=r[aa],x=z=void 0,"add"===h?(z=e.querySelector('[name="'+y.Id+'"]'),x=w.serializeToString(z),fa=null,y.InReplyTo&&(fa=ba.ga.Xg(y.InReplyTo).authorId||"default"),a.annots.push({at:"create",aId:y.Id,author:ba.nL,aName:ba.Bv[ba.nL],parent:fa,xfdf:"<add>"+x+"</add>"})):"modify"===h?(z=e.querySelector('[name="'+y.Id+'"]'),x=w.serializeToString(z),a.annots.push({at:"modify",aId:y.Id,
xfdf:"<modify>"+x+"</modify>"})):"delete"===h&&a.annots.push({at:"delete",aId:y.Id});0<a.annots.length&&ba.connection.send(a);return[2]}})})}.bind(ba);this.ga.addEventListener(la.a.Events.ANNOTATION_CHANGED,this.Qn)};ha.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ha}();Object(xa.a)(f);ta["default"]=f}}]);}).call(this || window)
